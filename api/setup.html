<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tajnur Authentication Setup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .step {
            background: #ecf0f1;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        .code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .btn {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .credentials {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Tajnur Authentication System Setup</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è PHP Required:</strong> This system requires PHP and MySQL to be installed on your server.
        </div>

        <h2>üìã Setup Instructions</h2>
        
        <div class="step">
            <h3>Step 1: Install Requirements</h3>
            <p>Install the following on your server:</p>
            <ul>
                <li><strong>PHP 7.4+</strong> with PDO MySQL extension</li>
                <li><strong>MySQL 5.7+</strong> or MariaDB</li>
                <li><strong>Web Server</strong> (Apache/Nginx) with PHP support</li>
            </ul>
        </div>

        <div class="step">
            <h3>Step 2: Create Database</h3>
            <p>Run this SQL script in your MySQL database:</p>
            <div class="code">
CREATE DATABASE IF NOT EXISTS tajnur_auth CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE tajnur_auth;

CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    email VARCHAR(100),
    role ENUM('admin', 'staff', 'manager') DEFAULT 'staff',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_login TIMESTAMP NULL,
    is_active BOOLEAN DEFAULT TRUE,
    failed_login_attempts INT DEFAULT 0,
    locked_until TIMESTAMP NULL
);

CREATE TABLE login_attempts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    ip_address VARCHAR(45) NOT NULL,
    attempt_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    success BOOLEAN DEFAULT FALSE,
    INDEX idx_username_time (username, attempt_time),
    INDEX idx_ip_time (ip_address, attempt_time)
);

CREATE TABLE user_sessions (
    id VARCHAR(128) PRIMARY KEY,
    user_id INT NOT NULL,
    ip_address VARCHAR(45) NOT NULL,
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_expires (expires_at)
);
            </div>
        </div>

        <div class="step">
            <h3>Step 3: Insert Default Users</h3>
            <p>Add the default user accounts:</p>
            <div class="code">
INSERT INTO users (username, password_hash, email, role) VALUES 
('admin', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'admin@tajnur.com', 'admin'),
('staff', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'staff@tajnur.com', 'staff'),
('manager', '$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', 'manager@tajnur.com', 'manager');
            </div>
        </div>

        <div class="step">
            <h3>Step 4: Configure Database Connection</h3>
            <p>Update the database configuration in <code>api/auth.php</code>:</p>
            <div class="code">
$db_config = [
    'host' => 'localhost',        // Your MySQL host
    'dbname' => 'tajnur_auth',   // Database name
    'username' => 'root',         // MySQL username
    'password' => ''              // MySQL password
];
            </div>
        </div>

        <div class="step">
            <h3>Step 5: Test the Setup</h3>
            <p>Once PHP and MySQL are configured, you can:</p>
            <ul>
                <li>Run <code>php api/setup_database.php</code> to auto-create tables</li>
                <li>Test the API endpoints</li>
                <li>Update the frontend JavaScript</li>
            </ul>
        </div>

        <h2>üîë Default Credentials</h2>
        <div class="credentials">
            <h4>Admin Account:</h4>
            <p><strong>Username:</strong> admin<br>
            <strong>Password:</strong> tajnur2024</p>
            
            <h4>Staff Account:</h4>
            <p><strong>Username:</strong> staff<br>
            <strong>Password:</strong> office123</p>
            
            <h4>Manager Account:</h4>
            <p><strong>Username:</strong> manager<br>
            <strong>Password:</strong> docs2024</p>
        </div>

        <h2>üåê API Endpoints</h2>
        <div class="step">
            <p>Once setup is complete, these endpoints will be available:</p>
            <ul>
                <li><code>POST /api/auth.php/login</code> - User authentication</li>
                <li><code>POST /api/auth.php/logout</code> - User logout</li>
                <li><code>GET /api/auth.php/verify</code> - Check authentication status</li>
                <li><code>GET /api/auth.php/csrf</code> - Get CSRF token</li>
            </ul>
        </div>

        <div class="success">
            <strong>‚úÖ Next Steps:</strong> After completing the database setup, proceed to update the frontend JavaScript to use these API endpoints instead of client-side authentication.
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="../office-documents.html" class="btn">‚Üê Back to Office Documents</a>
            <a href="auth.php/verify" class="btn">Test API Connection</a>
        </div>
    </div>
</body>
</html>